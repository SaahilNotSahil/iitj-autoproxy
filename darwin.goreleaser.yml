builds:
  - main: ./cli
    id: "cli"
    binary: ./bin/autoproxy
    goos:
      - darwin
    goarch:
      - arm64
    env:
      - CGO_ENABLED=1
    flags:
      - -mod=vendor

  - main: ./daemon
    id: "daemon"
    binary: ./bin/autoproxyd
    goos:
      - darwin
    goarch:
      - arm64
    env:
      - CGO_ENABLED=1
    flags:
      - -mod=vendor

release:
  prerelease: auto
  github:
    owner: XanderWatson
    name: iitj-autoproxy
  name_template: "{{.ProjectName}}-v{{.Version}}"

archives:
  - wrap_in_directory: false
    files:
      - LICENSE
      - README.md
      - autoproxy.config
      - scripts/*
      - darwin-install.sh

brews:
  - name: iitj-autoproxy
    url_template: "https://github.com/XanderWatson/iitj-autoproxy/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    download_strategy: CurlDownloadStrategy
    commit_author:
      name: XanderWatson
      email: saahil_bhavsar@outlook.com
    commit_msg_template: "Brew formula update for iitj-autoproxy version {{ .Tag }}"
    caveats: "How to use this binary"
    homepage: "https://github.com/XanderWatson/iitj-autoproxy"
    description: "A CLI tool to automatically login to IIT Jodhpur's network firewall."
    license: "MIT"
    skip_upload: false
    install: |
        chmod +x darwin-install.sh
        ./darwin-install.sh
    post_install: |
        mkdir -p /usr/share/licenses/iitj-autoproxy
        mkdir -p /usr/share/doc/iitj-autoproxy
        cp LICENSE /usr/share/licenses/iitj-autoproxy/LICENSE
        cp README.md /usr/share/doc/iitj-autoproxy/README.md
    repository:
      owner: XanderWatson
      name: homebrew-iitj-autoproxy
      branch: main
      pull_request:
        enabled: false
